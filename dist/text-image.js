module.exports=function(a,t){var o=require("fs"),c=a.createElement("pre"),g=a.createElement("canvas"),y=g.getContext("2d"),d={font:"Sans-serif",align:"left",color:"#000000",size:16,background:"rgba(0, 0, 0, 0)",stroke:0,strokeColor:"#FFFFFF",lineHeight:"1.2em",bold:!1,italic:!1},e=function(t){return this instanceof e?(this.setStyle(t),this):new e(t)};function n(t){console.log("convert",t),t=(t=String(t)).replace(/\\n/g,"\n"),c.innerHTML=t,c.innerText=t,c.setAttribute("style",this._style),a.body.append(c),console.log("convert >>",a.documentElement.outerHTML);var i,e=t.split("\n"),s=this.style.stroke,l=c.offsetHeight/e.length||this.style.size,o=this.style.paddingTop||2*this.style.size,n=this.style.paddingLeft||o,h=.1*l;console.log(s,l,e.length,d.size*e.length),g.width=c.offsetWidth+function(t){var e,i=0,s=-1;for(e in t)t[e].length>i&&(i=t[s=e].length);return t[s].length}(e)*(.6*this.style.size),g.height=c.offsetHeight||d.size*e.length,g.width+=2*n,g.height+=2*o,console.log(c.offsetWidth,c.offsetHeight,e,g.width,g.height),y.clearRect(0,0,g.width,g.height),console.log("canvas",g.width,g.height,this.style.align),y.fillStyle=this.style.background,y.beginPath(),y.fillRect(0,0,g.width,g.height),y.fill();var r="";switch(this.style.italic&&(r+="italic "),this.style.bold&&(r+="bold "),r+=this.style.size+"px "+this.style.font,y.font=r,y.textAlign=this.style.align,y.lineWidth=this.style.stroke,y.strokeStyle=this.style.strokeColor,y.fillStyle=this.style.color,y.textAlign){case"center":s=g.width/2;break;case"right":s=g.width-s;break;case"left":s+=n}i=(g.height-l*e.length)/2,e.forEach(function(t,e){this.style.stroke&&y.strokeText(t,s,l*(e+1)-h),y.fillText(t,s,l*(e+1)-h+i),console.log(t,s,l*(e+1)-h)}.bind(this)),y.fill(),a.body.removeChild(c)}return e.prototype.setStyle=function(t){for(var e in this.style=t||{},this.style.paddingTop=0,this.style.paddingLeft=0,d)this.style[e]||(this.style[e]=d[e]);return this._style="font: ",this.style.italic&&(this._style+="italic "),this.style.bold&&(this._style+="bold "),this._style+=this.style.size+"px "+this.style.font+";",this._style+="line-height:"+this.style.lineHeight+";",this._style+="text-align: "+this.style.align+";",this._style+="color: "+this.style.color+";",this._style+="background-color: "+this.style.background+";",this._style+=";padding: 10x; display: block; position: fixed; top: 100%; overflow: hidden;",this},e.prototype.setPadding=function(t,e){this.style.paddingLeft=t,this.style.paddingTop=e},e.prototype.toDataURL=function(t){return t&&n.call(this,t),g.toDataURL()},e.prototype.toImage=function(t,e){n.call(this,t);var i=new Image;return e&&(i.onload=e),i.src=g.toDataURL(),i},e.prototype.toFile=function(t,e){n.call(this,t);var i=new Image;i.src=g.toDataURL(),console.log(i.src);var s=i.src.replace(/^data:image\/\w+;base64,/,""),l=new Buffer(s,"base64");o.writeFile(e,l,function(t,e){if(t)throw t;console.log("File saved.")})},t.TextImage=e};